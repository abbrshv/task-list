(()=>{"use strict";function t({tagName:t,className:e,attributes:a={}}){const n=document.createElement(t);if(e){const t=e.split(" ").filter(Boolean);n.classList.add(...t)}return Object.keys(a).forEach((t=>n.setAttribute(t,a[t]))),n}const e=["task","random thought","idea"],a=new class{#t=-1;#e=new Map;generateId(){return this.#t+=1,this.#t}create(t){const e={...t};return e.id=this.generateId(),e.createdDate=new Date,this.#e.set(e.id,e).has(e.id)}get(t){return{...this.#e.get(t)}}getAll(){return[...this.#e.values()]}update(t){return this.#e.set(t.id,t).has(t.id)}delete(t){return this.#e.delete(t)}};class n{constructor(t,e,a){this.name=t,this.category=e,this.content=a}}class s{static dateRegex=/(0[1-9]|[12][0-9]|3[01])(\/|-)(0[1-9]|1[1,2])(\/|-)(19|20)\d{2}/g;getAll(){return a.getAll()||null}getAllActive(){const t=this.getAll();return t?t.filter((t=>!t.isArchived)):null}getAllArchived(){const t=this.getAll();return t?t.filter((t=>t.isArchived)):null}get(t){const e=a.get(t);if(!e)throw new Error(`Task with id ${t} doesn't exist`);return e}create(t){const{name:o,category:c,content:r}=t;if(!e.includes(c.toLowerCase()))throw new Error("Wrong task category");const i=new n(o,c.toLowerCase(),r);i.isArchived=!1,i.dates=i.content.match(s.dateRegex);const l=a.create(i);if(!l)throw new Error("Could not create task");return l}update(t,n){if(n.category&&!e.includes(n.category))throw new Error("Wrong task category");const o=Object.fromEntries(Object.entries(n).filter((([t,e])=>""!==e))),c={...this.get(t),...o};return c.dates=c.content.match(s.dateRegex),a.update(c)}delete(t){const e=a.delete(t);if(!e)throw new Error(`Task with id ${t} doesn't exist`);return e}changeArchive(t){const e=this.get(t);e.isArchived=!e.isArchived,this.update(t,e)}getStats(){const t=this.getAll();if(!t)return null;const a={};return a.active=e.map((e=>t.reduce(((t,a)=>t+(a.category===e?1:0)),0))),a.archived=e.map((e=>t.reduce(((t,a)=>t+(a.category===e?1:0)),0))),a}}const o=new s;function c(){const t=document.getElementsByClassName("modals-layer")[0];t?.remove(),document.querySelector(".btn-reload").click()}function r({title:e,bodyElement:a}){document.getElementsByClassName("modals-layer")[0]&&c();const n=document.querySelector(".container"),s=function({title:e,bodyElement:a}){const n=t({tagName:"div",className:"modals-layer"}),s=t({tagName:"div",className:"modals-root"}),o=function(e){const a=t({tagName:"div",className:"modals-header"}),n=t({tagName:"span"}),s=t({tagName:"div",className:"close-btn"});return n.innerText=e,s.innerText="×",s.addEventListener("click",(()=>{c()})),a.append(n,s),a}(e);return s.append(o,a),n.append(s),n}({title:e,bodyElement:a});n.append(s)}function i(a,s){const i=t({tagName:"div",className:"modals-input"}),l=function(...a){const n=t({tagName:"form",className:"input-form"}),s=t({tagName:"button",className:"btn btn-confirm"});s.textContent="Submit";const o=e.map((t=>new Option(t[0].toUpperCase()+t.substring(1),t)));return a.forEach((e=>{const a="category"===e?"select":"input",s=t({tagName:"label",className:`${e}-label`,attributes:{for:e}});s.textContent=e[0].toUpperCase()+e.substring(1);const c=t({tagName:a,className:`${e}-input`,attributes:{type:"text",id:e,name:e}});"category"===e&&c.append(...o),n.append(s,c)})),n.appendChild(s),n}(...Object.getOwnPropertyNames(new n));l.onsubmit=t=>{t.preventDefault();try{const e=Object.fromEntries(new FormData(t.target).entries());"create"===a?o.create(e):o.update(s,e),c()}catch(t){alert(`Could not ${a} task`),console.warn(t.message)}},i.append(l),r({title:"",bodyElement:i})}class l{static createCollapsible(e,a){const n=`${e.toLowerCase()}-content`,s=t({tagName:"div",className:"collapsible"}),o=t({tagName:"h2",className:"collapsible-header"});return o.textContent=e,a.classList.add("content",n),s.append(o,a),s.onclick=t=>{t.target.classList.add("active");const e=document.querySelector(`.${n}`);e.style.maxHeight?e.style.maxHeight=null:e.style.maxHeight="100%"},s}static createTableBase(e,...a){const n=t({tagName:"table",className:e}),s=t({tagName:"tr"});return a.forEach((e=>{const a=t({tagName:"th"});a.textContent=e,s.appendChild(a)})),n.appendChild(s),n}static createDataRow(...e){const a=t({tagName:"tr"});return e.forEach((e=>{const n=t({tagName:"td"});e instanceof HTMLElement?n.appendChild(e):n.textContent=e,a.append(n)})),a}static createRowButtons(e){const a=["✎","⇅","⌫"],n=t({tagName:"span"}),s=["edit","archive","delete"].map(((n,s)=>{const l=t({tagName:"button",className:`btn btn-${n}`});return l.textContent=a[s],l.onclick="edit"===n?()=>i(n,e):()=>function(e,a){const n=o.get(a),s=t({tagName:"div",className:"modals-confirm"}),i=t({tagName:"p",className:"modals-confirm-msg"}),l=t({tagName:"button",className:"btn btn-confirm"}),d=t({tagName:"button",className:"btn btn-deny"}),m=n.isArchived&&"archive"===e?`un${e}`:e;i.textContent=`Are you sure you want to ${m} this task?`,l.textContent=`${m[0].toUpperCase()+m.substring(1)}`,d.textContent="No",l.onclick=()=>{try{"delete"===e?o.delete(a):o.changeArchive(a),c()}catch(t){alert("Task does not exist"),console.warn(t.message)}},d.onclick=c,s.append(i,l,d),r({title:"",bodyElement:s})}(n,e),l}));return n.append(...s),n}static createTaskTable(e,a){const n=t({tagName:"div",className:`${e}-container`}),s=this.createTableBase(`task-table ${e}`,"Name","Created","Category","Content","Dates","");if(a.forEach((t=>{const e=this.createRowButtons(t.id),{name:a,category:n,content:o,dates:c,createdDate:r}=t,i=`${r.getDate()}/${r.getMonth()}/${r.getFullYear()}`,l=c?c.join(", "):"",d=this.createDataRow(a,i,n[0].toUpperCase()+n.substring(1),o,l,e);s.appendChild(d)})),n.appendChild(s),e.includes("active")){const e=t({tagName:"button",className:"btn btn-create"});e.textContent="+",e.onclick=()=>i("create"),n.appendChild(e)}return n}static createStatsTable(a){const n=t({tagName:"div",className:"stats-container"}),s=this.createTableBase("stats-table","Note Category","Active","Archived");return e.forEach(((t,e)=>{const n=t[0].toUpperCase()+t.substring(1),o=this.createDataRow(n,a.active[e],a.archived[e]);s.appendChild(o)})),n.appendChild(s),n}}class d{static loadTables(){const t=document.querySelector(".container"),e=l.createCollapsible("Archive",l.createTaskTable("task-archive",o.getAllArchived())),a=l.createCollapsible("Statistics",l.createStatsTable(o.getStats()));t.append(l.createTaskTable("task-active",o.getAllActive())),t.append(e,a)}static startApp(){const e=document.querySelector(".container");this.loadTables();const a=t({tagName:"button",className:"btn-reload"});a.style.display="none",a.addEventListener("click",(()=>{e.innerHTML="",this.startApp()})),e.append(a)}}const m=[{name:"Task 1",category:"task",content:"Content 1. Do something on 27-05-2023. Follow-up on 01-06-2023."},{name:"Task 2",category:"task",content:"Content 2. No dates here."},{name:"Task 3",category:"task",content:"Content 4. Remember 12/01/1998"},{name:"Random thought 1",category:"random thought",content:"Content 5. Just some random message without any dates."},{name:"Random thought 2",category:"random thought",content:"Content 6"},{name:"Idea 1",category:"idea",content:"Content 7"},{name:"Idea 2",category:"idea",content:"Content 8"}];try{m.forEach((t=>o.create(t))),d.startApp()}catch(t){console.warn(t)}})();