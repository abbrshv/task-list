(()=>{"use strict";function t({tagName:t,className:e,attributes:a={}}){const n=document.createElement(t);if(e){const t=e.split(" ").filter(Boolean);n.classList.add(...t)}return Object.keys(a).forEach((t=>n.setAttribute(t,a[t]))),n}const e=["task","random thought","idea"],a=new class{#t=-1;#e=new Map;generateId(){return this.#t+=1,this.#t}create(t){const e={...t};return e.id=this.generateId(),e.createdDate=new Date,this.#e.set(e.id,e).has(e.id)}get(t){return{...this.#e.get(t)}}getAll(){return[...this.#e.values()]}update(t){return this.#e.set(t.id,t).has(t.id)}delete(t){return this.#e.delete(t)}};class n{constructor(t,e,a){this.name=t,this.category=e,this.content=a}}const s=new class{dateRegex=/(0[1-9]|[12][0-9]|3[01])(\/|-)(0[1-9]|1[1,2])(\/|-)(19|20)\d{2}/g;getAll(){return a.getAll()||null}getAllActive(){return a.getAll().filter((t=>!t.isArchived))||null}getAllArchived(){return a.getAll().filter((t=>t.isArchived))||null}get(t){const e=a.get(t);if(!e)throw new Error(`Task with id ${t} doesn't exist`);return e}create(t){const{name:s,category:o,content:r}=t;if(!e.includes(o.toLowerCase()))throw new Error("Wrong task category");const c=new n(s,o.toLowerCase(),r);this.isArchived=!1,c.dates=c.content.match(this.dateRegex);const i=a.create(c);if(!i)throw new Error("Could not create task");return i}update(t,n){if(n.category&&!e.includes(n.category))throw new Error("Wrong task category");const s=Object.fromEntries(Object.entries(n).filter((([t,e])=>""!==e))),o={...this.get(t),...s};return o.dates=o.content.match(this.dateRegex),a.update(o)}delete(t){const e=a.delete(t);if(!e)throw new Error(`Task with id ${t} doesn't exist`);return e}changeArchive(t){const e=this.get(t);e.isArchived=!e.isArchived,this.update(t,e)}getStats(){const t={};return t.active=e.map((t=>this.getAllActive().reduce(((e,a)=>e+(a.category===t?1:0)),0))),t.archived=e.map((t=>this.getAllArchived().reduce(((e,a)=>e+(a.category===t?1:0)),0))),t}};function o(){const t=document.getElementsByClassName("modals-layer")[0];t?.remove(),document.querySelector(".btn-reload").click()}function r({title:e,bodyElement:a}){document.getElementsByClassName("modals-layer")[0]&&o();const n=document.querySelector(".container"),s=function({title:e,bodyElement:a}){const n=t({tagName:"div",className:"modals-layer"}),s=t({tagName:"div",className:"modals-root"}),r=function(e){const a=t({tagName:"div",className:"modals-header"}),n=t({tagName:"span"}),s=t({tagName:"div",className:"close-btn"});return n.innerText=e,s.innerText="Ã—",s.addEventListener("click",(()=>{o()})),a.append(n,s),a}(e);return s.append(r,a),n.append(s),n}({title:e,bodyElement:a});n.append(s)}function c(a,c){const i=t({tagName:"div",className:"modals-input"}),l=function(...a){const n=t({tagName:"form",className:"input-form"}),s=t({tagName:"button",className:"btn btn-confirm"});s.textContent="Submit";const o=e.map((t=>new Option(t[0].toUpperCase()+t.substring(1),t)));return a.forEach((e=>{const a="category"===e?"select":"input",s=t({tagName:"label",className:`${e}-label`,attributes:{for:e}});s.textContent=e[0].toUpperCase()+e.substring(1);const r=t({tagName:a,className:`${e}-input`,attributes:{type:"text",id:e,name:e}});"category"===e&&r.append(...o),n.append(s,r)})),n.appendChild(s),n}(...Object.getOwnPropertyNames(new n));l.onsubmit=t=>{t.preventDefault();try{const e=Object.fromEntries(new FormData(t.target).entries());"create"===a?s.create(e):s.update(c,e),o()}catch(t){alert(`Could not ${a} task`),console.warn(t.message)}},i.append(l),r({title:"",bodyElement:i})}class i{static createTableBase(e,...a){const n=t({tagName:"table",className:e}),s=t({tagName:"tr"});return a.forEach((e=>{const a=t({tagName:"th"});a.textContent=e,s.appendChild(a)})),n.appendChild(s),n}static createDataRow(...e){const a=t({tagName:"tr"});return e.forEach((e=>{const n=t({tagName:"td"});e instanceof HTMLElement?n.appendChild(e):n.textContent=e,a.append(n)})),a}static createRowButtons(e){const a=t({tagName:"span"}),n=["edit","archive","delete"].map((a=>{const n=t({tagName:"button",className:`btn btn-${a}`});return n.onclick="edit"===a?()=>c(a,e):()=>function(e,a){const n=t({tagName:"div",className:"modals-confirm"}),c=t({tagName:"p",className:"modals-confirm-msg"}),i=t({tagName:"button",className:"btn btn-confirm"}),l=t({tagName:"button",className:"btn btn-deny"});c.textContent=`Are you sure you want to ${e} this task?`,i.textContent=`${e[0].toUpperCase()+e.substring(1)}`,l.textContent="No",i.onclick=()=>{try{"delete"===e?s.delete(a):s.changeArchive(a),o()}catch(t){alert("Task does not exist"),console.warn(t.message)}},l.onclick=o,n.append(c,i,l),r({title:"",bodyElement:n})}(a,e),n}));return a.append(...n),a}static createTaskTable(e,a){const n=t({tagName:"div",className:`${e}-container`}),s=this.createTableBase(`task-table ${e}`,"Name","Created","Category","Content","Dates","");if(a.forEach((t=>{const e=this.createRowButtons(t.id),{name:a,category:n,content:o,dates:r,createdDate:c}=t,i=`${c.getDate()}/${c.getMonth()}/${c.getFullYear()}`,l=r?r.join(", "):"",d=this.createDataRow(a,i,n[0].toUpperCase()+n.substring(1),o,l,e);s.appendChild(d)})),n.appendChild(s),e.includes("active")){const e=t({tagName:"button",className:"btn btn-create"});e.onclick=()=>c("create"),n.appendChild(e)}return n}static createStatsTable(a){const n=t({tagName:"div",className:"stats-container"}),s=this.createTableBase("stats-table","Note Category","Active","Archived");return e.forEach(((t,e)=>{const n=t[0].toUpperCase()+t.substring(1),o=this.createDataRow(n,a.active[e],a.archived[e]);s.appendChild(o)})),n.appendChild(s),n}}class l{static loadTables(){const t=document.querySelector(".container");t.append(i.createTaskTable("task-active",s.getAllActive())),t.append(i.createTaskTable("task-archive",s.getAllArchived())),t.append(i.createStatsTable(s.getStats()))}static startApp(){const e=document.querySelector(".container");this.loadTables();const a=t({tagName:"button",className:"btn-reload"});a.style.display="none",a.addEventListener("click",(()=>{e.innerHTML="",this.startApp()})),e.append(a)}}const d=[{name:"Task 1",category:"task",content:"Content 1. Do something on 27-05-2023. Follow-up on 01-06-2023."},{name:"Task 2",category:"task",content:"Content 2. No dates here."},{name:"Task 3",category:"task",content:"Content 4. Remember 12/01/1998"},{name:"Random thought 1",category:"random thought",content:"Content 5. Just some random message without any dates."},{name:"Random thought 2",category:"random thought",content:"Content 6"},{name:"Idea 1",category:"idea",content:"Content 7"},{name:"Idea 2",category:"idea",content:"Content 8"}];try{d.forEach((t=>s.create(t))),s.create({name:"Do it",category:"task",content:"banana"}),l.startApp()}catch(t){console.warn(t)}})();